PRUEBA TFM
================

- [R Markdown](#r-markdown)
- [Validació](#validació)

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax
for authoring HTML, PDF, and MS Word documents. For more details on
using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that
includes both content as well as the output of any embedded R code
chunks within the document. You can embed an R code chunk like this:

``` r
serie <- read.csv("datos.csv",                 # Nombre del archivo o ruta completa del archivo
         header = TRUE)
```

``` r
# Cargar las librerías necesarias
library(dplyr)
```

    ## 
    ## Adjuntando el paquete: 'dplyr'

    ## The following objects are masked from 'package:stats':
    ## 
    ##     filter, lag

    ## The following objects are masked from 'package:base':
    ## 
    ##     intersect, setdiff, setequal, union

``` r
library(tidyr)
library(lubridate)
```

    ## 
    ## Adjuntando el paquete: 'lubridate'

    ## The following objects are masked from 'package:base':
    ## 
    ##     date, intersect, setdiff, union

``` r
# Convertir la columna 'last_updated' a formato datetime con segundos
serie$last_updated <- ymd_hms(serie$last_updated)

# Crear las nuevas columnas de fecha y hora
serie <- serie %>%
  mutate(Fecha_solo = as.Date(last_updated),    # Solo la fecha
         Hora_solo = format(last_updated, "%H:%M:%S"))  # Solo la hora

# Pivotear los datos para tener horas como columnas y fechas como filas
tabla_pivot <- serie %>%
  select(Fecha_solo, Hora_solo, X3.0) %>%
  pivot_wider(names_from = Hora_solo, values_from = X3.0)

# Convertir a data.frame para poder manipular las filas con rownames
tabla_pivot <- as.data.frame(tabla_pivot)

# Asignar las fechas como nombres de las filas
rownames(tabla_pivot) <- tabla_pivot$Fecha_solo

# Eliminar la columna 'Fecha_solo' ya que ahora es el nombre de las filas
tabla_pivot <- tabla_pivot[, -1]

# Si quieres limitar las filas como antes
tabla_pivot <- tabla_pivot[1:60, 1:24]

# Mostrar el resultado
print(tabla_pivot)
```

    ##              00:00:00  01:00:00  02:00:00  03:00:00  04:00:00  05:00:00
    ## 2024-06-01 12.7272727 11.416667 13.500000 14.750000 14.833333 13.583333
    ## 2024-06-02  7.5833333  8.750000  8.166667 10.000000 11.500000 11.833333
    ## 2024-06-03 15.5000000 17.000000 16.230769 16.000000 16.083333 16.000000
    ## 2024-06-04  8.8333333 11.000000 11.000000 11.000000 11.250000 11.833333
    ## 2024-06-05 10.0000000 10.583333 11.000000 11.000000 10.384615  8.250000
    ## 2024-06-06  7.4166667  8.583333  9.250000  7.000000  7.000000  8.583333
    ## 2024-06-07  9.8333333 12.000000 11.833333 12.416667 11.416667 13.250000
    ## 2024-06-08  8.5833333 10.333333 12.583333 11.083333  9.461538  8.545455
    ## 2024-06-09 16.3333333 17.250000 18.416667 19.250000 21.083333 21.166667
    ## 2024-06-10 12.4166667 12.083333 12.333333 12.250000 10.583333 11.583333
    ## 2024-06-11  8.0000000  9.000000 10.000000  7.692308  7.272727  8.583333
    ## 2024-06-12 19.7272727 18.916667 19.833333 19.666667 18.846154 18.545455
    ## 2024-06-13 15.4166667 16.000000 15.166667 16.583333 16.833333 15.333333
    ## 2024-06-14 24.2500000 25.000000 24.250000 24.583333 24.166667 25.083333
    ## 2024-06-15  7.0000000 11.583333 12.750000 12.000000 10.666667 11.153846
    ## 2024-06-16 14.6666667 16.083333 18.583333 21.333333 19.833333 18.166667
    ## 2024-06-17 20.5000000 20.250000 21.000000 20.615385 20.000000 19.916667
    ## 2024-06-18  9.8333333 10.666667 13.666667 15.000000 14.833333 13.333333
    ## 2024-06-19 16.2500000 17.500000 18.000000 18.461538 18.363636 18.083333
    ## 2024-06-20 12.3636364 13.000000 13.250000 15.166667 13.000000 14.583333
    ## 2024-06-21 13.6666667 14.166667 13.090909 13.000000 14.333333 16.333333
    ## 2024-06-22  8.3333333  4.454545  4.750000  6.166667  5.250000  7.583333
    ## 2024-06-23 24.5384615 22.181818 21.333333 20.583333 20.833333 23.750000
    ## 2024-06-24 24.0000000 12.000000  9.500000  6.666667  3.333333  2.333333
    ## 2024-06-25  5.2500000  6.750000  6.083333  5.923077  7.454545 12.333333
    ## 2024-06-26 14.0833333 14.500000 15.000000 15.750000 15.250000 17.666667
    ## 2024-06-27  9.0000000 10.083333 11.000000 12.000000 12.666667 12.666667
    ## 2024-06-28 16.4166667 17.000000 17.083333 18.166667 20.333333 24.166667
    ## 2024-06-29 11.4166667 10.750000 11.083333 11.416667 13.666667 16.923077
    ## 2024-06-30 17.1666667 17.250000 17.615385 17.545455 17.166667 17.250000
    ## 2024-07-01 10.5454545 11.000000 11.000000 10.583333 10.000000  9.333333
    ## 2024-07-02 14.9166667 17.916667 18.500000 18.666667 19.416667 22.583333
    ## 2024-07-03 22.2500000 21.333333 22.000000 22.000000 22.750000 24.666667
    ## 2024-07-04 13.5833333 13.916667 13.500000 14.083333 14.909091 19.916667
    ## 2024-07-05 15.7272727 17.666667 17.000000 17.666667 20.916667 24.083333
    ## 2024-07-06  6.3846154  9.545455 11.000000  9.500000 11.583333 13.916667
    ## 2024-07-07 16.7500000 20.666667 20.545455 22.083333 23.000000 24.916667
    ## 2024-07-08 10.4545455 10.000000 10.000000 10.153846  9.181818 10.333333
    ## 2024-07-09 10.1666667 11.500000 13.000000 12.333333 10.583333 13.916667
    ## 2024-07-10 11.0000000 12.916667 14.000000 14.000000 12.833333 12.083333
    ## 2024-07-11  9.6666667 10.000000 10.416667 11.583333 11.416667 12.250000
    ## 2024-07-12  8.4166667  8.416667  8.833333  9.000000  9.416667 13.833333
    ## 2024-07-13  9.8333333 13.166667 15.833333 15.000000 15.416667 15.666667
    ## 2024-07-14 20.6363636 20.333333 20.583333 21.500000 21.166667 19.750000
    ## 2024-07-15  0.1666667  1.727273  1.250000  1.666667  1.333333  1.916667
    ## 2024-07-16 17.8333333 18.333333 19.000000 19.000000 19.333333 24.750000
    ## 2024-07-17 15.2500000 16.916667 16.666667 16.000000 15.666667 15.250000
    ## 2024-07-18 12.0833333 12.166667 12.750000 11.833333 13.333333 22.416667
    ## 2024-07-19 26.8333333 26.500000 27.000000 26.666667 26.166667 25.916667
    ## 2024-07-20 14.2500000  1.750000  1.250000  3.166667  2.666667  3.666667
    ## 2024-07-21  0.8333333  1.818182  1.666667  4.250000  2.666667  2.500000
    ## 2024-07-22 16.0833333 15.583333 17.000000 17.000000 17.916667 15.333333
    ## 2024-07-23  5.5833333  6.333333  7.000000  7.833333  7.833333 10.166667
    ## 2024-07-24 12.1666667 12.916667 13.666667 14.583333 13.416667 11.250000
    ## 2024-07-25  8.5000000  7.250000  6.666667  6.909091  8.416667  9.166667
    ## 2024-07-26 16.9166667 18.333333 19.000000 18.416667 16.500000 15.916667
    ## 2024-07-27 19.6666667 21.272727 20.916667 21.166667  9.583333  9.833333
    ## 2024-07-28 16.0000000 12.500000 13.500000 15.166667 14.833333 13.583333
    ## 2024-07-29  5.9166667  6.250000  6.583333  5.916667  5.416667  5.750000
    ## 2024-07-30  6.0000000  7.666667  9.750000  9.666667  9.500000  9.833333
    ##             06:00:00   07:00:00  08:00:00   09:00:00  10:00:00   11:00:00
    ## 2024-06-01 16.583333 19.5000000 18.000000 22.1666667 23.916667 21.7500000
    ## 2024-06-02 12.583333 18.0833333 24.166667 24.6666667 23.500000 22.6666667
    ## 2024-06-03 12.416667 10.0000000 13.750000 15.4166667 18.000000 16.3333333
    ## 2024-06-04 10.583333  6.0833333  8.166667  7.6666667  8.583333 11.5000000
    ## 2024-06-05  4.727273  2.1666667  1.416667  0.2500000  1.083333  3.2500000
    ## 2024-06-06  5.916667  4.3333333  2.250000  0.7500000  2.333333  0.9166667
    ## 2024-06-07 11.923077 10.3636364  9.833333  7.2500000  3.500000  3.6666667
    ## 2024-06-08 12.000000 14.1666667 14.500000 13.2500000 16.583333 19.3333333
    ## 2024-06-09 21.916667 20.2500000 16.166667 15.8333333 13.666667 14.5833333
    ## 2024-06-10 10.416667 10.5000000  9.750000  7.9166667 11.583333 13.5000000
    ## 2024-06-11  6.916667  5.2500000  5.916667  5.9166667  3.750000  4.5833333
    ## 2024-06-12 13.583333  3.7500000  1.916667  2.0000000  4.000000  4.1538462
    ## 2024-06-13  8.583333  4.6363636  3.750000  4.3333333  4.500000 10.2500000
    ## 2024-06-14 25.333333  6.7500000  5.583333  5.1666667  5.166667  4.9166667
    ## 2024-06-15 10.583333 14.3636364 15.083333 13.4545455 17.500000 18.0833333
    ## 2024-06-16 18.833333 22.5833333 22.230769 20.4545455 20.500000 18.8333333
    ## 2024-06-17 20.076923 17.0000000 17.636364 18.4166667 19.384615 20.4545455
    ## 2024-06-18  9.500000  5.5833333  4.750000  1.9166667  3.083333  3.6923077
    ## 2024-06-19 17.333333 13.4166667 15.333333 16.7500000 20.333333 16.2500000
    ## 2024-06-20 12.083333 10.1666667  8.916667  8.3333333  8.250000  8.1666667
    ## 2024-06-21 18.333333 13.7500000 13.250000 11.6666667 12.000000 12.4166667
    ## 2024-06-22  9.500000 17.8333333 24.333333 22.8333333 21.416667 20.4166667
    ## 2024-06-23 25.583333 26.0000000 23.750000 24.8333333 19.500000 16.0000000
    ## 2024-06-24  4.750000  7.9166667  9.923077  9.2727273 10.500000  8.5000000
    ## 2024-06-25 13.333333 10.8333333  9.000000  7.6666667  8.666667 14.2307692
    ## 2024-06-26 18.583333 15.2500000 16.250000 15.6666667 17.692308 19.1818182
    ## 2024-06-27 11.750000  8.0000000  3.583333  3.5833333  3.250000  5.3333333
    ## 2024-06-28 20.333333 15.8333333 16.833333 15.0000000 14.083333 17.3333333
    ## 2024-06-29 19.454545 16.3846154  9.090909  8.8333333  8.083333  4.5833333
    ## 2024-06-30 18.750000 17.1666667 17.666667 14.8333333 13.750000 15.5833333
    ## 2024-07-01  7.583333  9.0000000  9.000000  9.4166667 12.000000 11.3333333
    ## 2024-07-02  3.916667  9.3333333 12.166667 11.7500000 11.250000 13.8333333
    ## 2024-07-03 22.416667 19.0000000 18.750000 17.9166667 14.916667 15.2500000
    ## 2024-07-04 18.833333  4.2500000  1.666667  3.0000000  5.500000 10.6666667
    ## 2024-07-05 22.250000 22.7500000 23.166667 23.5000000 24.916667 11.8333333
    ## 2024-07-06 15.250000 15.9166667 19.500000 23.0000000 20.833333 20.8181818
    ## 2024-07-07 17.500000  8.3333333 11.333333 15.3333333 22.000000 22.9166667
    ## 2024-07-08 11.083333  7.0000000  6.333333  6.8333333  6.083333 11.0000000
    ## 2024-07-09 14.333333 10.4166667  3.916667  3.3333333  4.333333  5.5384615
    ## 2024-07-10  9.916667  8.2500000  9.666667  7.0833333  5.750000  7.6666667
    ## 2024-07-11 10.666667  8.0833333  8.750000  7.0000000  9.307692 15.9090909
    ## 2024-07-12 15.083333 18.1666667 19.833333 17.6666667 13.083333  6.8333333
    ## 2024-07-13 19.833333  8.4166667  8.583333  9.5833333 12.000000 14.0833333
    ## 2024-07-14 20.416667 23.8333333  6.500000  8.1666667  4.250000  5.2500000
    ## 2024-07-15  3.083333  1.3333333  1.500000  5.3333333  5.750000  6.8333333
    ## 2024-07-16 24.230769 20.0909091 18.461538 17.8181818 18.000000 19.9166667
    ## 2024-07-17 14.250000 10.3333333  8.000000 10.4166667 14.363636 14.5833333
    ## 2024-07-18 22.923077 23.3636364 23.333333 21.5000000 12.666667 16.6666667
    ## 2024-07-19 25.833333 22.1666667 19.750000 19.2500000  9.250000  9.0833333
    ## 2024-07-20  5.083333  5.0833333  6.916667  6.6666667  8.583333 24.0833333
    ## 2024-07-21  1.461538  3.0000000  3.500000  4.2500000  4.333333  5.8333333
    ## 2024-07-22 11.833333  8.5833333  7.916667  9.1666667  9.666667 10.0000000
    ## 2024-07-23  5.250000  4.5833333  5.083333  6.4166667  4.500000  4.6666667
    ## 2024-07-24  9.083333  2.3333333  1.500000  1.1666667  1.666667  1.9166667
    ## 2024-07-25  9.250000  7.0909091  1.166667  0.4166667  1.416667  3.4615385
    ## 2024-07-26 15.818182 11.5833333 10.083333 12.5833333  9.833333 11.2500000
    ## 2024-07-27 20.416667 16.4166667 22.750000 26.0000000 24.916667 24.3333333
    ## 2024-07-28 14.083333 18.8333333 22.000000 18.0000000 15.750000 16.4166667
    ## 2024-07-29  3.666667  3.5000000  1.916667  1.0833333  2.416667  2.5833333
    ## 2024-07-30  1.166667  0.8333333  2.916667  5.6666667  6.666667  5.3333333
    ##              12:00:00  13:00:00  14:00:00  15:00:00  16:00:00  17:00:00
    ## 2024-06-01 18.2500000 21.500000 22.333333 14.916667 11.833333 12.166667
    ## 2024-06-02 22.0000000 15.500000 13.250000 14.769231 17.727273 13.750000
    ## 2024-06-03 17.7500000 16.916667 12.833333 16.833333 18.250000 24.153846
    ## 2024-06-04 10.0833333  9.916667  7.250000  8.166667 14.750000 19.250000
    ## 2024-06-05  0.4166667  2.833333  3.083333  5.333333  2.916667  5.916667
    ## 2024-06-06  3.0000000  3.000000  3.916667  4.166667  7.666667  8.416667
    ## 2024-06-07  7.5000000  9.583333 12.000000 11.333333  7.500000  3.083333
    ## 2024-06-08 22.8333333 15.416667 15.083333 12.615385 12.000000 14.666667
    ## 2024-06-09 18.6666667 16.916667 13.333333 14.583333 11.333333 10.250000
    ## 2024-06-10 13.0000000 14.727273 13.833333 15.500000 19.000000 23.000000
    ## 2024-06-11  8.1666667 12.500000 13.818182 14.416667 14.833333 16.166667
    ## 2024-06-12  5.7272727  4.083333  2.750000  8.166667 15.916667 15.916667
    ## 2024-06-13 11.7500000 15.083333 14.083333 13.583333 14.833333 20.666667
    ## 2024-06-14  9.0833333 10.916667 18.666667 23.833333 12.500000  6.833333
    ## 2024-06-15 23.6666667 25.250000 22.916667 20.666667 20.833333 18.538462
    ## 2024-06-16 14.1666667 18.500000 16.250000 15.000000 16.916667 16.583333
    ## 2024-06-17 20.1666667 22.833333 21.250000 22.750000 21.166667 13.384615
    ## 2024-06-18  4.4545455  6.500000  6.500000  8.181818 16.500000 13.500000
    ## 2024-06-19  8.2500000  7.166667  4.916667  1.333333  2.916667  3.750000
    ## 2024-06-20  8.6666667  7.416667 13.000000 17.833333 19.083333 11.833333
    ## 2024-06-21 12.7692308 11.363636 15.000000 17.000000 16.000000 13.076923
    ## 2024-06-22 15.3333333 14.416667 18.692308 20.363636 15.454545 17.416667
    ## 2024-06-23 15.2727273 17.250000 21.153846 23.333333 22.090909 20.615385
    ## 2024-06-24  9.5833333  9.166667 10.666667  6.916667  3.727273  5.583333
    ## 2024-06-25  8.8333333  6.700000  8.363636  5.923077  4.181818  8.166667
    ## 2024-06-26 19.5000000 17.916667 16.416667 18.000000 21.166667 11.000000
    ## 2024-06-27  4.6153846  8.363636 17.416667 18.083333  4.416667  6.166667
    ## 2024-06-28 19.7692308 19.090909 18.500000 20.166667 16.000000  9.416667
    ## 2024-06-29  5.8333333  3.916667  3.000000  6.000000  3.750000  3.416667
    ## 2024-06-30 23.0769231 19.727273 14.076923 14.545455 12.615385 12.363636
    ## 2024-07-01  9.2500000 14.333333 14.833333 13.916667  9.500000  9.833333
    ## 2024-07-02 12.9166667  9.166667 10.750000 11.500000 12.750000 14.461538
    ## 2024-07-03 13.5833333 12.500000 10.272727 11.000000  9.230769  9.400000
    ## 2024-07-04 13.1666667 12.500000 10.636364  8.500000  8.250000  8.916667
    ## 2024-07-05  7.1666667  4.666667  4.250000  4.307692 11.454545 11.833333
    ## 2024-07-06 21.2500000 19.000000 20.333333 19.416667 18.750000 16.583333
    ## 2024-07-07 23.2500000 20.333333 20.384615 16.727273 17.000000 18.583333
    ## 2024-07-08  8.9166667  8.416667  7.916667 10.583333 10.333333 15.333333
    ## 2024-07-09  6.0909091  5.916667  9.416667  9.083333  8.916667  7.916667
    ## 2024-07-10  8.0833333  7.833333  8.000000  5.250000  6.750000  6.583333
    ## 2024-07-11 15.5000000 10.750000  9.750000  7.416667  6.416667  7.250000
    ## 2024-07-12  8.4166667 11.250000 13.916667 15.166667 12.833333 14.083333
    ## 2024-07-13 11.6666667 16.416667 13.833333 14.416667 15.000000 17.076923
    ## 2024-07-14  3.4166667  5.000000  5.000000  5.416667  6.833333  6.166667
    ## 2024-07-15  8.8333333 10.750000  9.083333  9.416667 11.666667 15.909091
    ## 2024-07-16 21.5833333 25.250000 26.333333  8.833333  7.833333  9.166667
    ## 2024-07-17 13.5833333 12.916667 18.500000 16.166667 14.083333 16.000000
    ## 2024-07-18 22.1666667 22.083333 24.083333 20.500000  9.833333  3.416667
    ## 2024-07-19 13.5000000 12.416667 17.500000 16.769231 20.636364 15.750000
    ## 2024-07-20 21.4166667 26.461538 21.000000 21.333333 24.666667 26.750000
    ## 2024-07-21 18.0833333 15.833333 11.083333 10.000000  9.000000 11.833333
    ## 2024-07-22 13.7500000 15.818182 11.666667  5.750000 10.750000 20.833333
    ## 2024-07-23  7.0833333  4.083333  1.500000  2.750000  1.583333  2.076923
    ## 2024-07-24  3.8333333  5.916667  4.416667  5.833333  7.750000 11.416667
    ## 2024-07-25  7.0909091  7.000000  5.750000  6.666667  9.333333  9.333333
    ## 2024-07-26 14.2500000  9.333333 13.250000 17.750000 17.750000 15.416667
    ## 2024-07-27 25.5000000 25.166667 24.000000 23.166667 17.916667 22.416667
    ## 2024-07-28 19.1666667 22.500000 22.083333 19.083333 18.416667 19.583333
    ## 2024-07-29  4.1538462  6.727273  4.250000  2.500000  1.166667  4.583333
    ## 2024-07-30  5.0833333  5.750000  6.416667  6.461538  4.454545  3.666667
    ##             18:00:00  19:00:00  20:00:00  21:00:00  22:00:00  23:00:00
    ## 2024-06-01 10.000000 10.416667 11.333333 11.538462  9.818182  8.333333
    ## 2024-06-02 13.916667 12.833333 14.769231 14.090909 13.818182 13.833333
    ## 2024-06-03 12.000000 12.166667 13.500000  7.166667  7.250000  9.500000
    ## 2024-06-04 19.666667  4.250000  3.250000  7.083333  7.583333 10.250000
    ## 2024-06-05  4.333333  6.000000  8.250000  5.416667  8.250000  8.500000
    ## 2024-06-06 12.666667  8.583333  5.833333  9.000000  8.909091  8.333333
    ## 2024-06-07  3.250000  5.916667  5.916667  5.333333  5.750000  6.583333
    ## 2024-06-08 13.083333 15.500000 14.666667 15.083333 13.250000 14.166667
    ## 2024-06-09 12.166667 11.250000 10.666667 10.250000 11.000000 11.666667
    ## 2024-06-10 23.083333  9.666667  5.000000  5.666667  6.416667  7.461538
    ## 2024-06-11 16.750000 17.250000 18.250000 19.333333 19.000000 19.923077
    ## 2024-06-12 14.416667 16.000000 16.272727 14.333333 14.166667 15.000000
    ## 2024-06-13 22.333333 25.166667 19.833333 18.750000 22.250000 24.416667
    ## 2024-06-14 12.000000 17.666667 16.833333 19.833333 20.250000  4.916667
    ## 2024-06-15 14.916667 14.818182 15.916667 15.916667 15.333333 15.750000
    ## 2024-06-16 17.583333 19.000000 18.416667 17.000000 18.666667 19.833333
    ## 2024-06-17  9.727273 11.500000 12.083333 10.000000 10.583333  9.666667
    ## 2024-06-18 10.384615 12.636364  9.666667 10.750000 12.166667 13.583333
    ## 2024-06-19 15.916667 14.083333  8.416667  7.333333 10.166667 11.846154
    ## 2024-06-20 12.250000 12.250000 10.583333  9.416667 11.583333 13.750000
    ## 2024-06-21 15.000000 16.727273  9.833333 14.416667 18.083333 19.000000
    ## 2024-06-22 18.166667 23.916667 24.538462 23.818182 23.181818 24.333333
    ## 2024-06-23 20.272727 21.333333 18.461538 19.818182 24.166667 24.000000
    ## 2024-06-24  4.916667  1.083333  2.333333  5.000000  4.083333  4.333333
    ## 2024-06-25 18.333333 18.083333 15.538462 14.090909 11.500000 11.416667
    ## 2024-06-26  1.500000  1.000000  1.000000  5.272727  7.833333  7.000000
    ## 2024-06-27  5.416667  9.833333 15.166667 16.307692 16.727273 17.500000
    ## 2024-06-28 14.666667 13.500000  9.250000  9.666667 10.666667 12.750000
    ## 2024-06-29  3.166667 15.923077 18.909091 18.250000 17.230769 18.454545
    ## 2024-06-30 10.750000  8.500000  7.416667  9.166667  8.833333  9.083333
    ## 2024-07-01 13.500000 16.166667 18.333333 16.083333 14.416667 13.333333
    ## 2024-07-02 22.181818 15.583333 24.250000 22.083333 20.333333 21.916667
    ## 2024-07-03 10.083333 11.000000 12.833333 11.666667  9.416667 10.583333
    ## 2024-07-04  7.583333 11.666667 14.333333 15.500000 13.500000 14.692308
    ## 2024-07-05  9.538462  5.000000  5.166667  5.333333  4.750000  4.666667
    ## 2024-07-06 16.166667 15.000000 16.750000 13.416667 13.923077 14.454545
    ## 2024-07-07 18.833333 16.166667 14.833333 14.583333  9.583333  9.615385
    ## 2024-07-08 18.230769 12.000000 10.083333  5.583333  8.750000 10.333333
    ## 2024-07-09 13.333333 10.166667 10.666667  7.916667 10.750000  9.909091
    ## 2024-07-10  7.000000  7.916667 11.500000 10.416667 10.500000 11.583333
    ## 2024-07-11  6.923077  7.000000  9.000000  8.363636  9.250000  9.083333
    ## 2024-07-12  8.500000  7.750000  7.000000  5.333333  7.250000  7.250000
    ## 2024-07-13 17.727273 16.333333 17.750000 19.166667 19.545455 18.692308
    ## 2024-07-14  5.916667  7.916667 10.583333  2.750000  1.272727  1.000000
    ## 2024-07-15 14.833333 19.916667 16.333333 15.416667 16.416667 18.250000
    ## 2024-07-16 14.166667 14.166667 12.500000 13.416667 13.916667 15.333333
    ## 2024-07-17 20.166667 22.250000 25.333333 23.750000 11.833333 13.083333
    ## 2024-07-18  4.083333  9.250000 15.833333 20.916667 22.666667 25.818182
    ## 2024-07-19 12.250000 22.833333 22.250000 24.500000 24.583333 22.750000
    ## 2024-07-20 21.416667 16.666667 21.666667 20.750000 15.333333  8.846154
    ## 2024-07-21 12.166667 18.916667 19.916667 18.000000 16.454545 14.833333
    ## 2024-07-22 10.416667 11.416667  9.083333  4.750000  3.692308  5.909091
    ## 2024-07-23  4.909091  4.916667  7.000000  7.916667  9.416667 11.416667
    ## 2024-07-24  8.666667 11.916667 11.833333  8.750000  8.000000  8.083333
    ## 2024-07-25 11.166667 10.307692 10.909091 11.583333 13.416667 15.750000
    ## 2024-07-26 17.692308 19.545455 18.384615 18.909091 16.583333 18.083333
    ## 2024-07-27 19.666667 19.916667 18.916667 15.666667 14.000000 16.916667
    ## 2024-07-28 18.250000 17.666667 15.333333  9.166667  6.083333  5.500000
    ## 2024-07-29  5.500000  5.833333  3.833333  4.166667  5.583333  6.083333
    ## 2024-07-30  3.500000  3.833333  3.583333  2.416667  3.000000  4.416667

``` r
# Convertir la tabla pivoteada en un vector
vector_serie <- as.vector(t(tabla_pivot))  # 't' transpone para asegurar que se aplanen las columnas

# Crear la serie temporal (ts)
serie <- ts(vector_serie, frequency = 24)  # Se asume una frecuencia de 24 observaciones por "unidad de tiempo" (es decir, por día)
```

![](PRUEBA-TFM---copia_files/figure-gfm/pressure-1.png)<!-- -->

``` r
m=apply(matrix(serie,nr=24),2,mean)
v=apply(matrix(serie,nr=24),2,var)
plot(m,v,xlab="Medias anuales",ylab="Varianzas anuales",main="serie")
abline(lm(v~m),col=2,lty=3,lwd=2)
```

![](PRUEBA-TFM---copia_files/figure-gfm/unnamed-chunk-3-1.png)<!-- -->

``` r
plot(m,v,xlab="Medias anuales",ylab="Varianzas anuales",main="serie",ylim=c(0,60))
abline(lm(v~m), col=2, lty=3,lwd=2)
```

![](PRUEBA-TFM---copia_files/figure-gfm/unnamed-chunk-4-1.png)<!-- -->

``` r
boxplot(serie~floor(time(serie)))
```

![](PRUEBA-TFM---copia_files/figure-gfm/unnamed-chunk-5-1.png)<!-- -->

``` r
lnserie=log(serie)
plot(lnserie)
```

![](PRUEBA-TFM---copia_files/figure-gfm/unnamed-chunk-6-1.png)<!-- -->

``` r
boxplot(lnserie~floor(time(lnserie)))
```

![](PRUEBA-TFM---copia_files/figure-gfm/unnamed-chunk-7-1.png)<!-- -->

``` r
plot(decompose(lnserie))
```

![](PRUEBA-TFM---copia_files/figure-gfm/unnamed-chunk-8-1.png)<!-- -->

``` r
# Cargar las librerías necesarias
library(ggplot2)

# Crear un vector que represente las horas del día para cada observación
# Como tienes una serie temporal con frecuencia de 24 (una por cada hora del día)
horas <- rep(0:23, length.out = length(lnserie))

# Crear un data frame con la serie y las horas
df <- data.frame(Hora = factor(horas, levels = 0:23), Valor = as.numeric(lnserie))

# Graficar los valores agrupados por hora del día
ggplot(df, aes(x = Hora, y = Valor)) +
  geom_boxplot() +
  labs(title = "Distribución de los Valores por Hora del Día",
       x = "Hora del Día", y = "Valor") +
  theme_minimal()
```

![](PRUEBA-TFM---copia_files/figure-gfm/unnamed-chunk-9-1.png)<!-- -->

``` r
d24lnserie=diff(lnserie,24)
plot(d24lnserie)
abline(h=0)
abline(h=mean(d24lnserie),col=2)
```

![](PRUEBA-TFM---copia_files/figure-gfm/unnamed-chunk-10-1.png)<!-- -->

``` r
d1d24lnserie=diff(d24lnserie,1)
plot(d1d24lnserie)
abline(h=0)
```

![](PRUEBA-TFM---copia_files/figure-gfm/unnamed-chunk-11-1.png)<!-- -->

``` r
var(lnserie)
```

    ## [1] 0.4417944

``` r
var(d24lnserie)
```

    ## [1] 0.7466614

``` r
var(d1d24lnserie)
```

    ## [1] 0.2598003

``` r
d1d1d24lnserie=diff(d1d24lnserie,1) # No necesaria
var(d1d1d24lnserie)
```

    ## [1] 0.5377966

``` r
par(mfrow=c(1,2))
acf(d1d24lnserie,ylim=c(-1,1),col=c(2,rep(1,23)),lwd=2,lag.max=96)
pacf(d1d24lnserie,ylim=c(-1,1),col=c(rep(1,23),2),lwd=2,lag.max=96)
```

![](PRUEBA-TFM---copia_files/figure-gfm/unnamed-chunk-13-1.png)<!-- -->

``` r
par(mfrow=c(1,1))
```

``` r
(mod1=arima(d1d24lnserie,order=c(1,0,1),seasonal=list(order=c(0,0,1),period=24)))
```

    ## 
    ## Call:
    ## arima(x = d1d24lnserie, order = c(1, 0, 1), seasonal = list(order = c(0, 0, 
    ##     1), period = 24))
    ## 
    ## Coefficients:
    ##           ar1     ma1     sma1  intercept
    ##       -0.5950  0.6216  -0.9810     -1e-04
    ## s.e.   0.3536  0.3440   0.0214      6e-04
    ## 
    ## sigma^2 estimated as 0.1323:  log likelihood = -614.81,  aic = 1239.61

## Validació

``` r
#################Validation#################################
validation=function(model,dades){
  s=frequency(get(model$series))
  resid=model$residuals
  par(mfrow=c(2,2),mar=c(3,3,3,3))
  #Residuals plot
  plot(resid,main="Residuals")
  abline(h=0)
  abline(h=c(-3*sd(resid),3*sd(resid)),lty=3,col=4)
  #Square Root of absolute values of residuals (Homocedasticity)
  scatter.smooth(sqrt(abs(resid)),main="Square Root of Absolute residuals",
                 lpars=list(col=2))
  
  #Normal plot of residuals
  qqnorm(resid)
  qqline(resid,col=2,lwd=2)
  
  ##Histogram of residuals with normal curve
  hist(resid,breaks=20,freq=FALSE)
  curve(dnorm(x,mean=mean(resid),sd=sd(resid)),col=2,add=T)
  
  
  #ACF & PACF of residuals
  par(mfrow=c(1,2))
  acf(resid,ylim=c(-1,1),lag.max=60,col=c(2,rep(1,s-1)),lwd=1)
  pacf(resid,ylim=c(-1,1),lag.max=60,col=c(rep(1,s-1),2),lwd=1)
  par(mfrow=c(1,1))
  
  #ACF & PACF of square residuals 
  par(mfrow=c(1,2))
  acf(resid^2,ylim=c(-1,1),lag.max=60,col=c(2,rep(1,s-1)),lwd=1)
  pacf(resid^2,ylim=c(-1,1),lag.max=60,col=c(rep(1,s-1),2),lwd=1)
  par(mfrow=c(1,1))
  
  #Ljung-Box p-values
  par(mar=c(2,2,1,1))
  tsdiag(model,gof.lag=7*s)
  cat("\n--------------------------------------------------------------------\n")
  print(model)
  
  #Stationary and Invertible
  cat("\nModul of AR Characteristic polynomial Roots: ", 
      Mod(polyroot(c(1,-model$model$phi))),"\n")
  cat("\nModul of MA Characteristic polynomial Roots: ",
      Mod(polyroot(c(1,model$model$theta))),"\n")
  
  #Model expressed as an MA infinity (psi-weights)
  psis=ARMAtoMA(ar=model$model$phi,ma=model$model$theta,lag.max=36)
  names(psis)=paste("psi",1:36)
  cat("\nPsi-weights (MA(inf))\n")
  cat("\n--------------------\n")
  print(psis[1:20])
  
  #Model expressed as an AR infinity (pi-weights)
  pis=-ARMAtoMA(ar=-model$model$theta,ma=-model$model$phi,lag.max=36)
  names(pis)=paste("pi",1:36)
  cat("\nPi-weights (AR(inf))\n")
  cat("\n--------------------\n")
  print(pis[1:20])
  
  ## Add here complementary tests (use with caution!)
  ##---------------------------------------------------------
  cat("\nNormality Tests\n")
  cat("\n--------------------\n")
 
  ##Shapiro-Wilks Normality test
  print(shapiro.test(resid(model)))

  suppressMessages(require(nortest,quietly=TRUE,warn.conflicts=FALSE))
  ##Anderson-Darling test
  print(ad.test(resid(model)))
  
  suppressMessages(require(tseries,quietly=TRUE,warn.conflicts=FALSE))
  ##Jarque-Bera test
  print(jarque.bera.test(resid(model)))
  
  cat("\nHomoscedasticity Test\n")
  cat("\n--------------------\n")
  suppressMessages(require(lmtest,quietly=TRUE,warn.conflicts=FALSE))
  ##Breusch-Pagan test
  obs=get(model$series)
  print(bptest(resid(model)~I(obs-resid(model))))
  
  cat("\nIndependence Tests\n")
  cat("\n--------------------\n")
  
  ##Durbin-Watson test
  print(dwtest(resid(model)~I(1:length(resid(model)))))
  
  ##Ljung-Box test
  cat("\nLjung-Box test\n")
  print(t(apply(matrix(c(1:4,(1:4)*s)),1,function(el) {
    te=Box.test(resid(model),type="Ljung-Box",lag=el)
    c(lag=(te$parameter),statistic=te$statistic[[1]],p.value=te$p.value)})))
  

  #Sample ACF vs. Teoric ACF
  par(mfrow=c(2,2),mar=c(3,3,3,3))
  acf(dades, ylim=c(-1,1) ,lag.max=36,main="Sample ACF")
  
  plot(ARMAacf(model$model$phi,model$model$theta,lag.max=36),ylim=c(-1,1), 
       type="h",xlab="Lag",  ylab="", main="ACF Teoric")
  abline(h=0)
  
  #Sample PACF vs. Teoric PACF
  pacf(dades, ylim=c(-1,1) ,lag.max=36,main="Sample PACF")
  
  plot(ARMAacf(model$model$phi,model$model$theta,lag.max=36, pacf=T),ylim=c(-1,1),
       type="h", xlab="Lag", ylab="", main="PACF Teoric")
  abline(h=0)
  par(mfrow=c(1,1))
}
################# Fi Validation #################################
```

No es válido

``` r
dades=d1d24lnserie
model=mod1
validation(model,dades)
```

![](PRUEBA-TFM---copia_files/figure-gfm/unnamed-chunk-16-1.png)<!-- -->![](PRUEBA-TFM---copia_files/figure-gfm/unnamed-chunk-16-2.png)<!-- -->![](PRUEBA-TFM---copia_files/figure-gfm/unnamed-chunk-16-3.png)<!-- -->![](PRUEBA-TFM---copia_files/figure-gfm/unnamed-chunk-16-4.png)<!-- -->

    ## 
    ## --------------------------------------------------------------------
    ## 
    ## Call:
    ## arima(x = d1d24lnserie, order = c(1, 0, 1), seasonal = list(order = c(0, 0, 
    ##     1), period = 24))
    ## 
    ## Coefficients:
    ##           ar1     ma1     sma1  intercept
    ##       -0.5950  0.6216  -0.9810     -1e-04
    ## s.e.   0.3536  0.3440   0.0214      6e-04
    ## 
    ## sigma^2 estimated as 0.1323:  log likelihood = -614.81,  aic = 1239.61
    ## 
    ## Modul of AR Characteristic polynomial Roots:  1.680636 
    ## 
    ## Modul of MA Characteristic polynomial Roots:  1.000801 1.000801 1.000801 1.000801 1.000801 1.000801 1.000801 1.000801 1.000801 1.000801 1.000801 1.000801 1.000801 1.000801 1.000801 1.000801 1.000801 1.000801 1.000801 1.000801 1.000801 1.000801 1.000801 1.000801 1.608714 
    ## 
    ## Psi-weights (MA(inf))
    ## 
    ## --------------------
    ##         psi 1         psi 2         psi 3         psi 4         psi 5 
    ##  2.660169e-02 -1.582835e-02  9.418072e-03 -5.603875e-03  3.334378e-03 
    ##         psi 6         psi 7         psi 8         psi 9        psi 10 
    ## -1.983998e-03  1.180504e-03 -7.024153e-04  4.179462e-04 -2.486834e-04 
    ##        psi 11        psi 12        psi 13        psi 14        psi 15 
    ##  1.479698e-04 -8.804396e-05  5.238729e-05 -3.117111e-05  1.854722e-05 
    ##        psi 16        psi 17        psi 18        psi 19        psi 20 
    ## -1.103583e-05  6.566463e-06 -3.907130e-06  2.324793e-06 -1.383282e-06 
    ## 
    ## Pi-weights (AR(inf))
    ## 
    ## --------------------
    ##          pi 1          pi 2          pi 3          pi 4          pi 5 
    ##  2.660169e-02 -1.653600e-02  1.027902e-02 -6.389588e-03  3.971861e-03 
    ##          pi 6          pi 7          pi 8          pi 9         pi 10 
    ## -2.468967e-03  1.534746e-03 -9.540205e-04  5.930331e-04 -3.686380e-04 
    ##         pi 11         pi 12         pi 13         pi 14         pi 15 
    ##  2.291508e-04 -1.424435e-04  8.854494e-05 -5.504083e-05  3.421418e-05 
    ##         pi 16         pi 17         pi 18         pi 19         pi 20 
    ## -2.126804e-05  1.322052e-05 -8.218069e-06  5.108472e-06 -3.175501e-06 
    ## 
    ## Normality Tests
    ## 
    ## --------------------
    ## 
    ##  Shapiro-Wilk normality test
    ## 
    ## data:  resid(model)
    ## W = 0.85401, p-value < 2.2e-16
    ## 
    ## 
    ##  Anderson-Darling normality test
    ## 
    ## data:  resid(model)
    ## A = 54.029, p-value < 2.2e-16
    ## 
    ## 
    ##  Jarque Bera Test
    ## 
    ## data:  resid(model)
    ## X-squared = 4574.7, df = 2, p-value < 2.2e-16
    ## 
    ## 
    ## Homoscedasticity Test
    ## 
    ## --------------------
    ## 
    ##  studentized Breusch-Pagan test
    ## 
    ## data:  resid(model) ~ I(obs - resid(model))
    ## BP = 0.26295, df = 1, p-value = 0.6081
    ## 
    ## 
    ## Independence Tests
    ## 
    ## --------------------
    ## 
    ##  Durbin-Watson test
    ## 
    ## data:  resid(model) ~ I(1:length(resid(model)))
    ## DW = 2.0465, p-value = 0.8021
    ## alternative hypothesis: true autocorrelation is greater than 0
    ## 
    ## 
    ## Ljung-Box test
    ##      lag.df   statistic      p.value
    ## [1,]      1   0.7941134 3.728592e-01
    ## [2,]      2  11.9822041 2.500906e-03
    ## [3,]      3  28.1448472 3.386453e-06
    ## [4,]      4  33.9315833 7.696560e-07
    ## [5,]     24  63.9215575 1.749671e-05
    ## [6,]     48  75.8039737 6.419659e-03
    ## [7,]     72  98.1306162 2.206201e-02
    ## [8,]     96 111.0720111 1.393941e-01

![](PRUEBA-TFM---copia_files/figure-gfm/unnamed-chunk-16-5.png)<!-- -->
\## Forecasting

``` r
########### Model stability (without constant!!!) ###############

ultim=c(59,24)
pdq=c(1,1,1)
PDQ=c(0,1,1)

serie2=window(serie,end=ultim)
lnserie2=log(serie2)
serie1=window(serie,end=ultim+c(1,0))
lnserie1=log(serie1)

(modA=arima(lnserie1,order=pdq,seasonal=list(order=PDQ,period=12)))
```

    ## 
    ## Call:
    ## arima(x = lnserie1, order = pdq, seasonal = list(order = PDQ, period = 12))
    ## 
    ## Coefficients:
    ##           ar1     ma1     sma1
    ##       -0.5487  0.5815  -1.0000
    ## s.e.   0.3265  0.3165   0.0121
    ## 
    ## sigma^2 estimated as 0.1314:  log likelihood = -605.73,  aic = 1219.46

``` r
(modB=arima(lnserie2,order=pdq,seasonal=list(order=PDQ,period=12)))
```

    ## 
    ## Call:
    ## arima(x = lnserie2, order = pdq, seasonal = list(order = PDQ, period = 12))
    ## 
    ## Coefficients:
    ##           ar1     ma1     sma1
    ##       -0.5185  0.5424  -1.0000
    ## s.e.   0.4646  0.4579   0.0142
    ## 
    ## sigma^2 estimated as 0.1286:  log likelihood = -580.43,  aic = 1168.86

``` r
pred=predict(modB,n.ahead=24)
pr<-ts(c(tail(lnserie2,1),pred$pred),start=ultim,freq=24)
se<-ts(c(0,pred$se),start=ultim,freq=24)

#Intervals
tl<-ts(exp(pr-1.96*se),start=ultim,freq=24)
tu<-ts(exp(pr+1.96*se),start=ultim,freq=24)
pr<-ts(exp(pr),start=ultim,freq=24)


ts.plot(serie,tl,tu,pr,lty=c(1,2,2,1),col=c(1,4,4,2),xlim=c(1,61),type="o",main=paste("Model ARIMA(",paste(pdq,collapse=","),")(",paste(PDQ,collapse=","),")24",sep=""))
abline(v=1:61,lty=3,col=4)
```

![](PRUEBA-TFM---copia_files/figure-gfm/unnamed-chunk-18-1.png)<!-- -->

``` r
pr
```

    ## Time Series:
    ## Start = c(59, 24) 
    ## End = c(60, 24) 
    ## Frequency = 24 
    ##  [1] 6.083333 6.225538 6.545536 6.554381 6.658125 6.427969 6.811697 6.612179
    ##  [9] 6.020694 5.670261 5.416620 5.653087 6.048525 6.186585 6.506396 6.514246
    ## [17] 6.617851 6.388838 6.770368 6.571991 5.984134 5.635813 5.383721 5.618747
    ## [25] 6.011785

``` r
serie[1416:1440]
```

    ##  [1] 6.0833333 6.0000000 7.6666667 9.7500000 9.6666667 9.5000000 9.8333333
    ##  [8] 1.1666667 0.8333333 2.9166667 5.6666667 6.6666667 5.3333333 5.0833333
    ## [15] 5.7500000 6.4166667 6.4615385 4.4545455 3.6666667 3.5000000 3.8333333
    ## [22] 3.5833333 2.4166667 3.0000000 4.4166667

``` r
(previs=window(cbind(tl,pr,tu,serie,error=round(serie-pr,3)),start=ultim))
```

    ## Time Series:
    ## Start = c(59, 24) 
    ## End = c(60, 24) 
    ## Frequency = 24 
    ##                 tl       pr         tu     serie  error
    ## 59.95833 6.0833333 6.083333   6.083333 6.0833333  0.000
    ## 60.00000 3.0736506 6.225538  12.609543 6.0000000 -0.226
    ## 60.04167 2.3837358 6.545536  17.973484 7.6666667  1.121
    ## 60.08333 1.9025924 6.554381  22.579671 9.7500000  3.196
    ## 60.12500 1.5926894 6.658125  27.833817 9.6666667  3.009
    ## 60.16667 1.2982572 6.427969  31.826344 9.5000000  3.072
    ## 60.20833 1.1800409 6.811697  39.320009 9.8333333  3.022
    ## 60.25000 0.9950082 6.612179  43.940254 1.1666667 -5.446
    ## 60.29167 0.7946239 6.020694  45.617501 0.8333333 -5.187
    ## 60.33333 0.6616795 5.670261  48.591291 2.9166667 -2.754
    ## 60.37500 0.5625915 5.416620  52.151122 5.6666667  0.250
    ## 60.41667 0.5255977 5.653087  60.802004 6.6666667  1.014
    ## 60.45833 0.5058967 6.048525  72.316446 5.3333333 -0.715
    ## 60.50000 0.4667315 6.186585  82.003978 5.0833333 -1.103
    ## 60.54167 0.4445005 6.506396  95.237660 5.7500000 -0.756
    ## 60.58333 0.4044429 6.514246 104.923093 6.4166667 -0.098
    ## 60.62500 0.3745844 6.617851 116.918773 6.4615385 -0.156
    ## 60.66667 0.3306359 6.388838 123.450777 4.4545455 -1.934
    ## 60.70833 0.3212014 6.770368 142.707606 3.6666667 -3.104
    ## 60.75000 0.2865151 6.571991 150.746240 3.5000000 -3.072
    ## 60.79167 0.2402713 5.984134 149.039257 3.8333333 -2.151
    ## 60.83333 0.2088335 5.635813 152.094297 3.5833333 -2.052
    ## 60.87500 0.1844583 5.383721 157.132843 2.4166667 -2.967
    ## 60.91667 0.1783198 5.618747 177.043237 3.0000000 -2.619
    ## 60.95833 0.1770232 6.011785 204.162828 4.4166667 -1.595

``` r
obs=window(serie,start=ultim)

mod.RMSE1=sqrt(sum((obs-pr)^2)/12)
mod.MAE1=sum(abs(obs-pr))/12
mod.RMSPE1=sqrt(sum(((obs-pr)/obs)^2)/12)
mod.MAPE1=sum(abs(obs-pr)/obs)/12

data.frame("RMSE"=mod.RMSE1,"MAE"=mod.MAE1,"RMSPE"=mod.RMSPE1,"MAPE"=mod.MAPE1)
```

    ##       RMSE      MAE    RMSPE     MAPE
    ## 1 3.612061 4.218126 2.357234 1.646858

``` r
mCI1=mean(tu-tl)

cat("\nMean Length CI: ",mCI1)
```

    ## 
    ## Mean Length CI:  84.47713
